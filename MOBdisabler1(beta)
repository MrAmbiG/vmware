<#
.SYNOPSIS
    This uses the method of getting plink and setting the working directory as the resource directyr by alan from
    http://www.virtu-al.net/2013/01/07/ssh-powershell-tricks-with-plink-exe/

.DESCRIPTION
    A detailed description of the function or script. This keyword can be
    used only once in each topic.
.NOTES
    File Name      : MOBdisabler.ps1
    Author         : gajendra d ambi
    Prerequisite   : PowerShell V3 and powercli 5.x over Vista and upper.
    Copyright 2015 - None
.LINK
    Script posted over:
    http://ambitech.blogspot.in/2015/06/disable-mob-security-hardening-for.html
#>




$myDir = Split-Path -Parent $MyInvocation.MyCommand.Path
$PlinkLocation = $myDir + "\Plink.exe"
If (-not (Test-Path $PlinkLocation)){
   Write-Host "Plink.exe not found, trying to download..."
   $WC = new-object net.webclient
   $WC.DownloadFile("http://the.earth.li/~sgtatham/putty/latest/x86/plink.exe",$PlinkLocation)
   If (-not (Test-Path $PlinkLocation)){
      Write-Host "Unable to download plink.exe, please download from the following URL and add it to the same folder as this script: http://the.earth.li/~sgtatham/putty/latest/x86/plink.exe"
      Exit
   } Else {
      $PlinkEXE = Get-ChildItem $PlinkLocation
      If ($PlinkEXE.Length -gt 0) {
         Write-Host "Plink.exe downloaded, continuing script"
      } Else {
         Write-Host "Unable to download plink.exe, please download from the following URL and add it to the same folder as this script: http://the.earth.li/~sgtatham/putty/latest/x86/plink.exe"
         Exit
      }
   }  
}

Copy-Item $PSScriptRoot\plink.exe C:\

# Use SSH / plink to configure host with some additional script
$VMHost = "1.1.1.1"
$pass = ""

$cmd0 = "touch /tmp/mob.txt"
$cmd1 = "echo 'vim-cmd proxysvc/remove_service mob httpsWithRedirect' >> /tmp/mob.txt"

#now add quotes to the word mob and httpsWithRedirect using sed
$cmd2 = echo "sed 's/\bmob\b/"mob"/' -i /tmp/mob.txt"
$cmd3 = echo "sed 's/\bhttpsWithRedirect\b/"httpsWithRedirect"/' -i /tmp/mob.txt"
$cmd4 = "sh /tmp/mob.txt"

echo Y | F:\folder\plink.exe -ssh $hostIP -l root -pw gajuambi
C:\plink.exe -ssh -v $VMHost -l root -pw $pass $cmd0
C:\plink.exe -ssh -v $VMHost -l root -pw $pass $cmd1
C:\plink.exe -ssh -v $VMHost -l root -pw $pass $cmd2
C:\plink.exe -ssh -v $VMHost -l root -pw $pass $cmd3
C:\plink.exe -ssh -v $VMHost -l root -pw $pass $cmd4

Remove-Item C:\plink.exe
