#REQUIRES -Version 0.1

<#
.SYNOPSIS
    set the Disk.SchedNumReqOutstanding
	
.DESCRIPTION
    You have to run the esxcli storage core device set -d naa.******* -O 256
	against each naa id after listing them all on a host. It eases the same process
	by automating certain aspects of the process.
	Plans to use plink.exe and powercli in the next release.wish me luck.
.NOTES
    File Name      : Disk.SchedNumReqOutstanding.txt
    Author         : ambig1;twitter/MrAmbiG1
    Prerequisite   : esxi shell
    Copyright      - None
.LINK
    Script posted over: 
    

#>

#list the naa numbers and then export/append to a file
esxcli storage core path list | grep -i "Device: mpx" | cut -c 12-99 >> /opt/naa.txt

#set the Disk.SchedNumReqOutstanding to 256
esxcli storage core device set -d "$(< /opt/naa.txt)" -O 256

#run it in the shell
sh /tmp/naa.txt

#check the resuls
esxcli storage core device list -d "$(< /tmp/naa.txt)" | grep -i "outstanding"

#If all the naa IDs have the default value then run the contents of the /tmp/naa.txt on the host manually on hosts of the cluster.

#remove the naa.txt
rm /opt/naa.txt
