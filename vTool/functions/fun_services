<#
.SYNOPSIS
    Enable or disable services on a vmkernel/vmportgroup.
.DESCRIPTION
    This will create distributed portgroup for your DVS
.NOTES
    File Name      : fun_services.ps1
    Author         : gajendra d ambi
    Date           : february 2016
    recommended    : PowerShell v4+, powercli 6+ over win7 and upper.
    Copyright      - None
.LINK
    Script posted over: github.com/gajuambi/vmware   
#>

#start of script
#start of function
Function fun_services {
$cluster   = Read-Host "name of the cluster[type * to include all clusters]?"
$portgroup = Read-Host "name of the portgroup?"
Write-Host "
1. Enable management traffic
2. Enable vmotion
3. Enable fault tolerance
4. Enable vsan traffic
5. Disable management traffic
6. Disable vmotion
7. Disable fault tolerance
8. Disable vsan traffic
" -ForegroundColor Yellow

Write-Host "choose one of the above" -ForegroundColor Yellow
$option = ""
if ($option -EQ 1) {Get-Cluster $cluster | Get-VMhost | Get-VMHostNetworkAdapter | where PortGroupName -EQ $portgroup | Set-VMHostNetworkAdapter ManagementTrafficEnabled $true -Confirm:$false}
if ($option -EQ 2) {Get-Cluster $cluster | Get-VMhost | Get-VMHostNetworkAdapter | where PortGroupName -EQ $portgroup | Set-VMHostNetworkAdapter VMotionEnabled $true -Confirm:$false}
if ($option -EQ 3) {Get-Cluster $cluster | Get-VMhost | Get-VMHostNetworkAdapter | where PortGroupName -EQ $portgroup | Set-VMHostNetworkAdapter FaultToleranceLoggingEnabled $true -Confirm:$false}
if ($option -EQ 4) {Get-Cluster $cluster | Get-VMhost | Get-VMHostNetworkAdapter | where PortGroupName -EQ $portgroup | Set-VMHostNetworkAdapter VsanTrafficEnabled $true -Confirm:$false}
if ($option -EQ 5) {Get-Cluster $cluster | Get-VMhost | Get-VMHostNetworkAdapter | where PortGroupName -EQ $portgroup | Set-VMHostNetworkAdapter ManagementTrafficEnabled $false -Confirm:$false}
if ($option -EQ 6) {Get-Cluster $cluster | Get-VMhost | Get-VMHostNetworkAdapter | where PortGroupName -EQ $portgroup | Set-VMHostNetworkAdapter VMotionEnabled $false -Confirm:$false}
if ($option -EQ 7) {Get-Cluster $cluster | Get-VMhost | Get-VMHostNetworkAdapter | where PortGroupName -EQ $portgroup | Set-VMHostNetworkAdapter FaultToleranceLoggingEnabled $false -Confirm:$false}
if ($option -EQ 8) {Get-Cluster $cluster | Get-VMhost | Get-VMHostNetworkAdapter | where PortGroupName -EQ $portgroup | Set-VMHostNetworkAdapter VsanTrafficEnabled $false -Confirm:$false}
}
#End of function
fun_services
#End of script
