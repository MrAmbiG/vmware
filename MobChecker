<#
.SYNOPSIS
    check whether mob is disable don the esxi host or not.
.DESCRIPTION
    it connects to the vcenter server, creates a list of hostnames and converts them into the urls to check mob.
    unfortunately it is not working the way i intended. someone can help me use the output of the url to 
    confirm mob or till then use it the way it is.
    If the output contains (404) not found then mob is disabled.
    anything other than that means mob is enabled.
.NOTES
    File Name      : MobChecker.ps1
    Author         : gajendra d ambi
    Prerequisite   : PowerShell V2 over Vista and upper.
    Copyright      - None
.LINK
    Script posted over:
    https://github.com/gajuambi/vmware/
#>

Write-Host "recommended to Run this in powershell, that is right click this file and run in powershell"
#If using in powershell then add snapins below
Add-PSSnapin VMware.VimAutomation.Core -ea "SilentlyContinue"

#Generate a list of host file alter the values to look like an url
$path = "$PSScriptRoot"
$vc = Read-Host "address of the vcenter"
$pass = Read-Host "password to the vcenter"
Connect-VIServer $vc -user administrator@vsphere.local -Password $pass
$file = "$path\hosts.txt"
$vmhosts = get-vmhost | sort | select name | Out-File $file -force
$a = get-content $file
$a.Trim()|foreach {"https://"+$_ + "/mob"} | out-file $file -force

#remove 1st 3 lines
get-content $file |
    select -Skip 3 |
    set-content "$file-temp"
move "$file-temp" $file -Force

#remove last 2 lines
$content = get-content $file
$content[0..($content.length-3)] | out-file $file -force

#MOBchecker
$file = "$path\hosts.txt"
$URLs = get-content $file

foreach ($uri in $URLs)
{
$check = Invoke-WebRequest -Uri $uri
#$check.StatusCode

if ($check.StatusCode -eq 200) 
  {Write-Host "MOB is enabled on this $uri"}
  else 
  {Write-Host "MOB is disabled on this $uri"}
  }
  Write-Host "If the url output is (404) not found then the mob is disabled and if it is anything other than 404 then mob isn't disabled"
  #End of script
