<#
.SYNOPSIS
    Add luns by lun id
.DESCRIPTION
    This should find out the lun IDs of the naa numbers and add them using the lun id.
.NOTES
    File Name      : Addlun2.ps1
    Author         : gajendra d ambi
    Date           : december 2015
    Prerequisite   : PowerShell v3+, powercli 6+ over Vista and upper.
    Copyright      - None
.LINK
    Script posted over: http://ambitech.blogspot.in/
    https://github.com/gajuambi/vmware
#>

##Variables##
#enter the name of the lun id
$lunid     = ""
#enter the name of the datastore
$datastore = ""
#enter the name of the cluster
$cluster   = ""

#Start of Script#
$vmhost  = (get-cluster $cluster | get-vmhost)[0]
$naa     = (Get-SCSILun -VMhost $vmhost -LunType Disk | where runtimename -eq vmhba1:C0:T0:L$lunid).CanonicalName
New-Datastore -VMHost $vmhost -Name $datastore -Path $naa -vmfs

#Rescan HBAs for a cluster on a host by host basis
foreach ($a in (get-cluster $cluster | get-vmhost)) {
Write-Host "Rescanning of HBAs $a" -ForegroundColor Yellow
$a | Get-VMHostStorage -RescanAllHba | Out-Null
Write-Host "Rescan of all HBAs on $a is complete" -ForegroundColor Green
Write-Host ""
}

